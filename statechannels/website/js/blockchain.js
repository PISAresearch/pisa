var Web3 = require('web3');
var web3 = new Web3();
web3.setProvider(new web3.providers.HttpProvider());

var statechannelContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"pub","type":"address"},{"name":"h","type":"bytes32"},{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"}],"name":"verifySignature","outputs":[],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[],"name":"status","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"resolve","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"deadline","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sigs","type":"uint256[]"},{"name":"_i","type":"uint256"},{"name":"_hstate","type":"bytes32"}],"name":"setstate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"plist","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"bestRound","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"triggerDispute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"disputePeriod","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"latestClaim","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getStateHash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"t_start","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"hstate","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDispute","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_plist","type":"address[]"},{"name":"_disputePeriod","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"deadline","type":"uint256"}],"name":"EventDispute","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"bestround","type":"uint256"}],"name":"EventResolve","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"bestround","type":"uint256"},{"indexed":false,"name":"hstate","type":"bytes32"}],"name":"EventEvidence","type":"event"}]);
var statechannelAddr = statechannelContract.at("0xd6f2446d052225C1Ff3971a9BC89222b622f1acf");

var battleshipsContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"lastY","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getState","outputs":[{"name":"_turn","type":"uint8"},{"name":"_state","type":"uint8"},{"name":"_winner","type":"address"},{"name":"boardCommitments","type":"bytes32[2][10][10]"},{"name":"fieldRandomness","type":"uint128[2][10][10]"},{"name":"shiptiles","type":"bool[2][10][10]"},{"name":"revealedtiles","type":"bool[2][10][10]"},{"name":"shipCommitments","type":"bytes32[2][10]"},{"name":"shipRandomness","type":"uint128[2][10]"},{"name":"shipX","type":"uint8[2][2][10]"},{"name":"shipY","type":"uint8[2][2][10]"},{"name":"sunk","type":"bool[2][10]"},{"name":"_lastX","type":"uint8"},{"name":"_lastY","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"randomness","type":"uint128"},{"name":"ship","type":"bool"}],"name":"reveal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"lastUpdateHeight","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_turn","type":"uint8"},{"name":"_state","type":"uint8"},{"name":"_winner","type":"address"},{"name":"boardCommitments","type":"bytes32[2][10][10]"},{"name":"fieldRandomness","type":"uint128[2][10][10]"},{"name":"shiptiles","type":"bool[2][10][10]"},{"name":"revealedtiles","type":"bool[2][10][10]"},{"name":"shipCommitments","type":"bytes32[2][10]"},{"name":"shipRandomness","type":"uint128[2][10]"},{"name":"shipX","type":"uint8[2][2][10]"},{"name":"shipY","type":"uint8[2][2][10]"},{"name":"sunk","type":"bool[2][10]"},{"name":"_lastX","type":"uint8"},{"name":"_lastY","type":"uint8"}],"name":"setState","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"player","type":"uint8"},{"name":"shipidx","type":"uint8"},{"name":"x1","type":"uint8"},{"name":"x2","type":"uint8"},{"name":"y1","type":"uint8"},{"name":"y2","type":"uint8"}],"name":"isSunk","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"timeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"boardCommitments","type":"bytes32[10][10]"},{"name":"shipCommitments","type":"bytes32[10]"}],"name":"commitBoard","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getStateHash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"x","type":"uint8"},{"name":"y","type":"uint8"}],"name":"attack","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"shipIdx1","type":"uint8"},{"name":"shipIdx2","type":"uint8"}],"name":"adjacentOrOverlapping","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"idx","type":"uint8"},{"name":"shipFieldRandomness","type":"uint128[20]"},{"name":"shipRandomness","type":"uint128[10]"},{"name":"shipX1","type":"uint8[10]"},{"name":"shipY1","type":"uint8[10]"},{"name":"shipX2","type":"uint8[10]"},{"name":"shipY2","type":"uint8[10]"}],"name":"checkBoard","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"turn","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_player","type":"uint8"}],"name":"isCommitted","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"boards","outputs":[{"name":"committed","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"finishGame","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"fieldRandomness","type":"uint128"},{"name":"shipRandomness","type":"uint128"},{"name":"shipIdx","type":"uint8"},{"name":"shipx1","type":"uint8"},{"name":"shipy1","type":"uint8"},{"name":"shipx2","type":"uint8"},{"name":"shipy2","type":"uint8"}],"name":"revealSink","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"claimWin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"gameState","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"winner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastX","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"players","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"player0","type":"address"},{"name":"player1","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"}],"name":"BoardCommit","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"},{"indexed":false,"name":"x","type":"uint8"},{"indexed":false,"name":"y","type":"uint8"}],"name":"Attack","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"},{"indexed":false,"name":"hit","type":"bool"}],"name":"Reveal","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"}],"name":"Winner","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"},{"indexed":false,"name":"shipidx","type":"uint8"}],"name":"RevealSink","type":"event"},{"anonymous":false,"inputs":[],"name":"shipsize1","type":"event"},{"anonymous":false,"inputs":[],"name":"shipsize2","type":"event"},{"anonymous":false,"inputs":[],"name":"shipsize3","type":"event"},{"anonymous":false,"inputs":[],"name":"shipsize4","type":"event"}]);
var battleshipAddr = battleshipsContract.at("");
var defaultAc = "0xf9d7d465798c6fcbffc7f9032614b81489e15595";
var player1 = "0x0955ec34b2bbb705bd95b851c9e5fa730afe5c7d";
var player2 = "0x4cc0d43d9f252a6b93f76d2c561984c3bc77745b";

function watchBalance() {
    var coinbase = web3.eth.coinbase;
    var originalBalance = web3.eth.getBalance(coinbase).toNumber();
    var status = statechannelAddr.status();
    document.getElementById('coinbase').innerText = 'Address: ' + coinbase +
	'\n Balance: ' + originalBalance + '\n Dispute Status: ' + status;
}

function signMessage(state){
    var hstate = web3.sha3(state);
    const sig = web3.eth.sign(defaultAc, hstate);
    const player1sig = web3.personal.sign(hstate, player1, "player1");
    const player2sig = web3.personal.sign(hstate, player2, "player2");
    console.log(player1sig);
    console.log(player2sig);
}

function commit(fleet) {
    console.log("Creating commitments");

    // create board commitments
    console.log(fleet);
}
